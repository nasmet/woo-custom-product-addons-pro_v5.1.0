"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3577],{3398:function(e,t){var r=Object.prototype.hasOwnProperty;function o(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(e){return null}}function n(e){try{return encodeURIComponent(e)}catch(e){return null}}t.stringify=function(e,t){t=t||"";var o,i,s=[];for(i in"string"!=typeof t&&(t="?"),e)if(r.call(e,i)){if((o=e[i])||null!=o&&!isNaN(o)||(o=""),i=n(i),o=n(o),null===i||null===o)continue;s.push(i+"="+o)}return s.length?t+s.join("&"):""},t.parse=function(e){for(var t,r=/([^=?#&]+)=?([^&]*)/g,n={};t=r.exec(e);){var i=o(t[1]),s=o(t[2]);null===i||null===s||i in n||(n[i]=s)}return n}},7418:function(e){e.exports=function(e,t){if(t=t.split(":")[0],!(e=+e))return!1;switch(t){case"http":case"ws":return 80!==e;case"https":case"wss":return 443!==e;case"ftp":return 21!==e;case"gopher":return 70!==e;case"file":return!1}return 0!==e}},4564:function(e,t,r){var o=r(7418),n=r(3398),i=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,s=/[\n\r\t]/g,a=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,l=/:\d+$/,u=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,p=/^[a-zA-Z]:/;function c(e){return(e||"").toString().replace(i,"")}var f=[["#","hash"],["?","query"],function(e,t){return y(t.protocol)?e.replace(/\\/g,"/"):e},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],h={hash:1,query:1};function d(e){var t,o=("undefined"!=typeof window?window:void 0!==r.g?r.g:"undefined"!=typeof self?self:{}).location||{},n={},i=typeof(e=e||o);if("blob:"===e.protocol)n=new m(unescape(e.pathname),{});else if("string"===i)for(t in n=new m(e,{}),h)delete n[t];else if("object"===i){for(t in e)t in h||(n[t]=e[t]);void 0===n.slashes&&(n.slashes=a.test(e.href))}return n}function y(e){return"file:"===e||"ftp:"===e||"http:"===e||"https:"===e||"ws:"===e||"wss:"===e}function v(e,t){e=(e=c(e)).replace(s,""),t=t||{};var r,o=u.exec(e),n=o[1]?o[1].toLowerCase():"",i=!!o[2],a=!!o[3],l=0;return i?a?(r=o[2]+o[3]+o[4],l=o[2].length+o[3].length):(r=o[2]+o[4],l=o[2].length):a?(r=o[3]+o[4],l=o[3].length):r=o[4],"file:"===n?l>=2&&(r=r.slice(2)):y(n)?r=o[4]:n?i&&(r=r.slice(2)):l>=2&&y(t.protocol)&&(r=o[4]),{protocol:n,slashes:i||y(n),slashesCount:l,rest:r}}function m(e,t,r){if(e=(e=c(e)).replace(s,""),!(this instanceof m))return new m(e,t,r);var i,a,l,u,h,b,g=f.slice(),w=typeof t,_=this,U=0;for("object"!==w&&"string"!==w&&(r=t,t=null),r&&"function"!=typeof r&&(r=n.parse),i=!(a=v(e||"",t=d(t))).protocol&&!a.slashes,_.slashes=a.slashes||i&&t.slashes,_.protocol=a.protocol||t.protocol||"",e=a.rest,("file:"===a.protocol&&(2!==a.slashesCount||p.test(e))||!a.slashes&&(a.protocol||a.slashesCount<2||!y(_.protocol)))&&(g[3]=[/(.*)/,"pathname"]);U<g.length;U++)"function"!=typeof(u=g[U])?(l=u[0],b=u[1],l!=l?_[b]=e:"string"==typeof l?~(h="@"===l?e.lastIndexOf(l):e.indexOf(l))&&("number"==typeof u[2]?(_[b]=e.slice(0,h),e=e.slice(h+u[2])):(_[b]=e.slice(h),e=e.slice(0,h))):(h=l.exec(e))&&(_[b]=h[1],e=e.slice(0,h.index)),_[b]=_[b]||i&&u[3]&&t[b]||"",u[4]&&(_[b]=_[b].toLowerCase())):e=u(e,_);r&&(_.query=r(_.query)),i&&t.slashes&&"/"!==_.pathname.charAt(0)&&(""!==_.pathname||""!==t.pathname)&&(_.pathname=function(e,t){if(""===e)return t;for(var r=(t||"/").split("/").slice(0,-1).concat(e.split("/")),o=r.length,n=r[o-1],i=!1,s=0;o--;)"."===r[o]?r.splice(o,1):".."===r[o]?(r.splice(o,1),s++):s&&(0===o&&(i=!0),r.splice(o,1),s--);return i&&r.unshift(""),"."!==n&&".."!==n||r.push(""),r.join("/")}(_.pathname,t.pathname)),"/"!==_.pathname.charAt(0)&&y(_.protocol)&&(_.pathname="/"+_.pathname),o(_.port,_.protocol)||(_.host=_.hostname,_.port=""),_.username=_.password="",_.auth&&(~(h=_.auth.indexOf(":"))?(_.username=_.auth.slice(0,h),_.username=encodeURIComponent(decodeURIComponent(_.username)),_.password=_.auth.slice(h+1),_.password=encodeURIComponent(decodeURIComponent(_.password))):_.username=encodeURIComponent(decodeURIComponent(_.auth)),_.auth=_.password?_.username+":"+_.password:_.username),_.origin="file:"!==_.protocol&&y(_.protocol)&&_.host?_.protocol+"//"+_.host:"null",_.href=_.toString()}m.prototype={set:function(e,t,r){var i=this;switch(e){case"query":"string"==typeof t&&t.length&&(t=(r||n.parse)(t)),i[e]=t;break;case"port":i[e]=t,o(t,i.protocol)?t&&(i.host=i.hostname+":"+t):(i.host=i.hostname,i[e]="");break;case"hostname":i[e]=t,i.port&&(t+=":"+i.port),i.host=t;break;case"host":i[e]=t,l.test(t)?(t=t.split(":"),i.port=t.pop(),i.hostname=t.join(":")):(i.hostname=t,i.port="");break;case"protocol":i.protocol=t.toLowerCase(),i.slashes=!r;break;case"pathname":case"hash":if(t){var s="pathname"===e?"/":"#";i[e]=t.charAt(0)!==s?s+t:t}else i[e]=t;break;case"username":case"password":i[e]=encodeURIComponent(t);break;case"auth":var a=t.indexOf(":");~a?(i.username=t.slice(0,a),i.username=encodeURIComponent(decodeURIComponent(i.username)),i.password=t.slice(a+1),i.password=encodeURIComponent(decodeURIComponent(i.password))):i.username=encodeURIComponent(decodeURIComponent(t))}for(var u=0;u<f.length;u++){var p=f[u];p[4]&&(i[p[1]]=i[p[1]].toLowerCase())}return i.auth=i.password?i.username+":"+i.password:i.username,i.origin="file:"!==i.protocol&&y(i.protocol)&&i.host?i.protocol+"//"+i.host:"null",i.href=i.toString(),i},toString:function(e){e&&"function"==typeof e||(e=n.stringify);var t,r=this,o=r.host,i=r.protocol;i&&":"!==i.charAt(i.length-1)&&(i+=":");var s=i+(r.protocol&&r.slashes||y(r.protocol)?"//":"");return r.username?(s+=r.username,r.password&&(s+=":"+r.password),s+="@"):r.password?(s+=":"+r.password,s+="@"):"file:"!==r.protocol&&y(r.protocol)&&!o&&"/"!==r.pathname&&(s+="@"),(":"===o[o.length-1]||l.test(r.hostname)&&!r.port)&&(o+=":"),s+=o+r.pathname,(t="object"==typeof r.query?e(r.query):r.query)&&(s+="?"!==t.charAt(0)?"?"+t:t),r.hash&&(s+=r.hash),s}},m.extractProtocol=v,m.location=d,m.trimLeft=c,m.qs=n,e.exports=m},3577:function(e,t,r){r.d(t,{Z:function(){return wt}});var o=r(4060);const n="function"==typeof btoa,i="function"==typeof Buffer,s=("function"==typeof TextDecoder&&new TextDecoder,"function"==typeof TextEncoder?new TextEncoder:void 0),a=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="),l=((e=>{let t={};e.forEach(((e,r)=>t[e]=r))})(a),String.fromCharCode.bind(String)),u=("function"==typeof Uint8Array.from&&Uint8Array.from.bind(Uint8Array),e=>e.replace(/=/g,"").replace(/[+\/]/g,(e=>"+"==e?"-":"_"))),p=e=>{let t,r,o,n,i="";const s=e.length%3;for(let s=0;s<e.length;){if((r=e.charCodeAt(s++))>255||(o=e.charCodeAt(s++))>255||(n=e.charCodeAt(s++))>255)throw new TypeError("invalid character found");t=r<<16|o<<8|n,i+=a[t>>18&63]+a[t>>12&63]+a[t>>6&63]+a[63&t]}return s?i.slice(0,s-3)+"===".substring(s):i},c=n?e=>btoa(e):i?e=>Buffer.from(e,"binary").toString("base64"):p,f=i?e=>Buffer.from(e).toString("base64"):e=>{let t=[];for(let r=0,o=e.length;r<o;r+=4096)t.push(l.apply(null,e.subarray(r,r+4096)));return c(t.join(""))},h=e=>{if(e.length<2)return(t=e.charCodeAt(0))<128?e:t<2048?l(192|t>>>6)+l(128|63&t):l(224|t>>>12&15)+l(128|t>>>6&63)+l(128|63&t);var t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return l(240|t>>>18&7)+l(128|t>>>12&63)+l(128|t>>>6&63)+l(128|63&t)},d=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,y=e=>e.replace(d,h),v=i?e=>Buffer.from(e,"utf8").toString("base64"):s?e=>f(s.encode(e)):e=>c(y(e)),m=(e,t=!1)=>t?u(v(e)):v(e),b=m;var g=r(4564),w=r.n(g);function _(e){return _="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_(e)}function U(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function O(e){var t=R();return function(){var r,o=k(e);if(t){var n=k(this).constructor;r=Reflect.construct(o,arguments,n)}else r=o.apply(this,arguments);return function(e,t){if(t&&("object"===_(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function P(e){var t="function"==typeof Map?new Map:void 0;return P=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,o)}function o(){return S(e,arguments,k(this).constructor)}return o.prototype=Object.create(e.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),E(o,e)},P(e)}function S(e,t,r){return S=R()?Reflect.construct.bind():function(e,t,r){var o=[null];o.push.apply(o,t);var n=new(Function.bind.apply(e,o));return r&&E(n,r.prototype),n},S.apply(null,arguments)}function R(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function E(e,t){return E=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},E(e,t)}function k(e){return k=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},k(e)}var j=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&E(e,t)}(i,e);var t,r,o,n=O(i);function i(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(t=n.call(this,e)).originalRequest=o,t.originalResponse=s,t.causingError=r,null!=r&&(e+=", caused by ".concat(r.toString())),null!=o){var a=o.getHeader("X-Request-ID")||"n/a",l=o.getMethod(),u=o.getURL(),p=s?s.getStatus():"n/a",c=s?s.getBody()||"":"n/a";e+=", originated from request (method: ".concat(l,", url: ").concat(u,", response code: ").concat(p,", response text: ").concat(c,", request id: ").concat(a,")")}return t.message=e,t}return t=i,r&&U(t.prototype,r),o&&U(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(P(Error)),x=j;function C(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var o,n,i=[],s=!0,a=!1;try{for(r=r.call(e);!(s=(o=r.next()).done)&&(i.push(o.value),!t||i.length!==t);s=!0);}catch(e){a=!0,n=e}finally{try{s||null==r.return||r.return()}finally{if(a)throw n}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return q(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return q(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function q(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,o=new Array(t);r<t;r++)o[r]=e[r];return o}function T(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function A(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?T(Object(r),!0).forEach((function(t){D(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):T(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function D(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function F(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var z={endpoint:null,uploadUrl:null,metadata:{},fingerprint:null,uploadSize:null,onProgress:null,onChunkComplete:null,onSuccess:null,onError:null,onUploadUrlAvailable:null,overridePatchMethod:!1,headers:{},addRequestId:!1,onBeforeRequest:null,onAfterResponse:null,onShouldRetry:null,chunkSize:1/0,retryDelays:[0,1e3,3e3,5e3],parallelUploads:1,parallelUploadBoundaries:null,storeFingerprintForResuming:!0,removeFingerprintOnSuccess:!1,uploadLengthDeferred:!1,uploadDataDuringCreation:!1,urlStorage:null,fileReader:null,httpStack:null},H=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options=r,this.options.chunkSize=Number(this.options.chunkSize),this._urlStorage=this.options.urlStorage,this.file=t,this.url=null,this._req=null,this._fingerprint=null,this._urlStorageKey=null,this._offset=null,this._aborted=!1,this._size=null,this._source=null,this._retryAttempt=0,this._retryTimeout=null,this._offsetBeforeRetry=0,this._parallelUploads=null,this._parallelUploadUrls=null}var t,r,o;return t=e,r=[{key:"findPreviousUploads",value:function(){var e=this;return this.options.fingerprint(this.file,this.options).then((function(t){return e._urlStorage.findUploadsByFingerprint(t)}))}},{key:"resumeFromPreviousUpload",value:function(e){this.url=e.uploadUrl||null,this._parallelUploadUrls=e.parallelUploadUrls||null,this._urlStorageKey=e.urlStorageKey}},{key:"start",value:function(){var e=this,t=this.file;if(t)if(this.options.endpoint||this.options.uploadUrl||this.url){var r=this.options.retryDelays;if(null==r||"[object Array]"===Object.prototype.toString.call(r)){if(this.options.parallelUploads>1)for(var o=0,n=["uploadUrl","uploadSize","uploadLengthDeferred"];o<n.length;o++){var i=n[o];if(this.options[i])return void this._emitError(new Error("tus: cannot use the ".concat(i," option when parallelUploads is enabled")))}if(this.options.parallelUploadBoundaries){if(this.options.parallelUploads<=1)return void this._emitError(new Error("tus: cannot use the `parallelUploadBoundaries` option when `parallelUploads` is disabled"));if(this.options.parallelUploads!==this.options.parallelUploadBoundaries.length)return void this._emitError(new Error("tus: the `parallelUploadBoundaries` must have the same length as the value of `parallelUploads`"))}this.options.fingerprint(t,this.options).then((function(r){return null==r||"Calculated fingerprint: ".concat(r),e._fingerprint=r,e._source?e._source:e.options.fileReader.openFile(t,e.options.chunkSize)})).then((function(t){if(e._source=t,e.options.uploadLengthDeferred)e._size=null;else if(null!=e.options.uploadSize){if(e._size=Number(e.options.uploadSize),Number.isNaN(e._size))return void e._emitError(new Error("tus: cannot convert `uploadSize` option into a number"))}else if(e._size=e._source.size,null==e._size)return void e._emitError(new Error("tus: cannot automatically derive upload's size from input. Specify it manually using the `uploadSize` option or use the `uploadLengthDeferred` option"));e.options.parallelUploads>1||null!=e._parallelUploadUrls?e._startParallelUpload():e._startSingleUpload()})).catch((function(t){e._emitError(t)}))}else this._emitError(new Error("tus: the `retryDelays` option must either be an array or null"))}else this._emitError(new Error("tus: neither an endpoint or an upload URL is provided"));else this._emitError(new Error("tus: no file or stream to upload provided"))}},{key:"_startParallelUpload",value:function(){var t,r=this,o=this._size,n=0;this._parallelUploads=[];var i=null!=this._parallelUploadUrls?this._parallelUploadUrls.length:this.options.parallelUploads,s=null!==(t=this.options.parallelUploadBoundaries)&&void 0!==t?t:function(e,t){for(var r=Math.floor(e/t),o=[],n=0;n<t;n++)o.push({start:r*n,end:r*(n+1)});return o[t-1].end=e,o}(this._source.size,i);this._parallelUploadUrls&&s.forEach((function(e,t){e.uploadUrl=r._parallelUploadUrls[t]||null})),this._parallelUploadUrls=new Array(s.length);var a,l=s.map((function(t,i){var a=0;return r._source.slice(t.start,t.end).then((function(l){var u=l.value;return new Promise((function(l,p){var c=A(A({},r.options),{},{uploadUrl:t.uploadUrl||null,storeFingerprintForResuming:!1,removeFingerprintOnSuccess:!1,parallelUploads:1,parallelUploadBoundaries:null,metadata:{},headers:A(A({},r.options.headers),{},{"Upload-Concat":"partial"}),onSuccess:l,onError:p,onProgress:function(e){n=n-a+e,a=e,r._emitProgress(n,o)},onUploadUrlAvailable:function(){r._parallelUploadUrls[i]=f.url,r._parallelUploadUrls.filter((function(e){return Boolean(e)})).length===s.length&&r._saveUploadInUrlStorage()}}),f=new e(u,c);f.start(),r._parallelUploads.push(f)}))}))}));Promise.all(l).then((function(){(a=r._openRequest("POST",r.options.endpoint)).setHeader("Upload-Concat","final;".concat(r._parallelUploadUrls.join(" ")));var e=L(r.options.metadata);return""!==e&&a.setHeader("Upload-Metadata",e),r._sendRequest(a,null)})).then((function(e){if(B(e.getStatus(),200)){var t=e.getHeader("Location");null!=t?(r.url=$(r.options.endpoint,t),"Created upload at ".concat(r.url),r._emitSuccess()):r._emitHttpError(a,e,"tus: invalid or missing Location header")}else r._emitHttpError(a,e,"tus: unexpected response while creating upload")})).catch((function(e){r._emitError(e)}))}},{key:"_startSingleUpload",value:function(){return this._aborted=!1,null!=this.url?("Resuming upload from previous URL: ".concat(this.url),void this._resumeUpload()):null!=this.options.uploadUrl?("Resuming upload from provided URL: ".concat(this.options.uploadUrl),this.url=this.options.uploadUrl,void this._resumeUpload()):void this._createUpload()}},{key:"abort",value:function(t){var r=this;return null!=this._parallelUploads&&this._parallelUploads.forEach((function(e){e.abort(t)})),null!==this._req&&this._req.abort(),this._aborted=!0,null!=this._retryTimeout&&(clearTimeout(this._retryTimeout),this._retryTimeout=null),t&&null!=this.url?e.terminate(this.url,this.options).then((function(){return r._removeFromUrlStorage()})):Promise.resolve()}},{key:"_emitHttpError",value:function(e,t,r,o){this._emitError(new x(r,o,e,t))}},{key:"_emitError",value:function(e){var t=this;if(!this._aborted){if(null!=this.options.retryDelays&&(null!=this._offset&&this._offset>this._offsetBeforeRetry&&(this._retryAttempt=0),M(e,this._retryAttempt,this.options))){var r=this.options.retryDelays[this._retryAttempt++];return this._offsetBeforeRetry=this._offset,void(this._retryTimeout=setTimeout((function(){t.start()}),r))}if("function"!=typeof this.options.onError)throw e;this.options.onError(e)}}},{key:"_emitSuccess",value:function(){this.options.removeFingerprintOnSuccess&&this._removeFromUrlStorage(),"function"==typeof this.options.onSuccess&&this.options.onSuccess()}},{key:"_emitProgress",value:function(e,t){"function"==typeof this.options.onProgress&&this.options.onProgress(e,t)}},{key:"_emitChunkComplete",value:function(e,t,r){"function"==typeof this.options.onChunkComplete&&this.options.onChunkComplete(e,t,r)}},{key:"_createUpload",value:function(){var e=this;if(this.options.endpoint){var t=this._openRequest("POST",this.options.endpoint);this.options.uploadLengthDeferred?t.setHeader("Upload-Defer-Length",1):t.setHeader("Upload-Length",this._size);var r,o=L(this.options.metadata);""!==o&&t.setHeader("Upload-Metadata",o),this.options.uploadDataDuringCreation&&!this.options.uploadLengthDeferred?(this._offset=0,r=this._addChunkToRequest(t)):r=this._sendRequest(t,null),r.then((function(r){if(B(r.getStatus(),200)){var o=r.getHeader("Location");if(null!=o){if(e.url=$(e.options.endpoint,o),"Created upload at ".concat(e.url),"function"==typeof e.options.onUploadUrlAvailable&&e.options.onUploadUrlAvailable(),0===e._size)return e._emitSuccess(),void e._source.close();e._saveUploadInUrlStorage().then((function(){e.options.uploadDataDuringCreation?e._handleUploadResponse(t,r):(e._offset=0,e._performUpload())}))}else e._emitHttpError(t,r,"tus: invalid or missing Location header")}else e._emitHttpError(t,r,"tus: unexpected response while creating upload")})).catch((function(r){e._emitHttpError(t,null,"tus: failed to create upload",r)}))}else this._emitError(new Error("tus: unable to create upload because no endpoint is provided"))}},{key:"_resumeUpload",value:function(){var e=this,t=this._openRequest("HEAD",this.url);this._sendRequest(t,null).then((function(r){var o=r.getStatus();if(!B(o,200))return 423===o?void e._emitHttpError(t,r,"tus: upload is currently locked; retry later"):(B(o,400)&&e._removeFromUrlStorage(),e.options.endpoint?(e.url=null,void e._createUpload()):void e._emitHttpError(t,r,"tus: unable to resume upload (new upload cannot be created without an endpoint)"));var n=parseInt(r.getHeader("Upload-Offset"),10);if(Number.isNaN(n))e._emitHttpError(t,r,"tus: invalid or missing offset value");else{var i=parseInt(r.getHeader("Upload-Length"),10);!Number.isNaN(i)||e.options.uploadLengthDeferred?("function"==typeof e.options.onUploadUrlAvailable&&e.options.onUploadUrlAvailable(),e._saveUploadInUrlStorage().then((function(){if(n===i)return e._emitProgress(i,i),void e._emitSuccess();e._offset=n,e._performUpload()}))):e._emitHttpError(t,r,"tus: invalid or missing length value")}})).catch((function(r){e._emitHttpError(t,null,"tus: failed to resume upload",r)}))}},{key:"_performUpload",value:function(){var e,t=this;this._aborted||(this.options.overridePatchMethod?(e=this._openRequest("POST",this.url)).setHeader("X-HTTP-Method-Override","PATCH"):e=this._openRequest("PATCH",this.url),e.setHeader("Upload-Offset",this._offset),this._addChunkToRequest(e).then((function(r){B(r.getStatus(),200)?t._handleUploadResponse(e,r):t._emitHttpError(e,r,"tus: unexpected response while uploading chunk")})).catch((function(r){t._aborted||t._emitHttpError(e,null,"tus: failed to upload chunk at offset ".concat(t._offset),r)})))}},{key:"_addChunkToRequest",value:function(e){var t=this,r=this._offset,o=this._offset+this.options.chunkSize;return e.setProgressHandler((function(e){t._emitProgress(r+e,t._size)})),e.setHeader("Content-Type","application/offset+octet-stream"),(o===1/0||o>this._size)&&!this.options.uploadLengthDeferred&&(o=this._size),this._source.slice(r,o).then((function(r){var o=r.value,n=r.done;return t.options.uploadLengthDeferred&&n&&(t._size=t._offset+(o&&o.size?o.size:0),e.setHeader("Upload-Length",t._size)),null===o?t._sendRequest(e):(t._emitProgress(t._offset,t._size),t._sendRequest(e,o))}))}},{key:"_handleUploadResponse",value:function(e,t){var r=parseInt(t.getHeader("Upload-Offset"),10);if(Number.isNaN(r))this._emitHttpError(e,t,"tus: invalid or missing offset value");else{if(this._emitProgress(r,this._size),this._emitChunkComplete(r-this._offset,r,this._size),this._offset=r,r===this._size)return this._emitSuccess(),void this._source.close();this._performUpload()}}},{key:"_openRequest",value:function(e,t){var r=I(e,t,this.options);return this._req=r,r}},{key:"_removeFromUrlStorage",value:function(){var e=this;this._urlStorageKey&&(this._urlStorage.removeUpload(this._urlStorageKey).catch((function(t){e._emitError(t)})),this._urlStorageKey=null)}},{key:"_saveUploadInUrlStorage",value:function(){var e=this;if(!this.options.storeFingerprintForResuming||!this._fingerprint||null!==this._urlStorageKey)return Promise.resolve();var t={size:this._size,metadata:this.options.metadata,creationTime:(new Date).toString()};return this._parallelUploads?t.parallelUploadUrls=this._parallelUploadUrls:t.uploadUrl=this.url,this._urlStorage.addUpload(this._fingerprint,t).then((function(t){e._urlStorageKey=t}))}},{key:"_sendRequest",value:function(e){return N(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,this.options)}}],o=[{key:"terminate",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=I("DELETE",t,r);return N(o,null,r).then((function(e){if(204!==e.getStatus())throw new x("tus: unexpected response while terminating upload",null,o,e)})).catch((function(n){if(n instanceof x||(n=new x("tus: failed to terminate upload",n,o,null)),!M(n,0,r))throw n;var i=r.retryDelays[0],s=r.retryDelays.slice(1),a=A(A({},r),{},{retryDelays:s});return new Promise((function(e){return setTimeout(e,i)})).then((function(){return e.terminate(t,a)}))}))}}],r&&F(t.prototype,r),o&&F(t,o),Object.defineProperty(t,"prototype",{writable:!1}),e}();function L(e){return Object.entries(e).map((function(e){var t=C(e,2),r=t[0],o=t[1];return"".concat(r," ").concat(b(String(o)))})).join(",")}function B(e,t){return e>=t&&e<t+100}function I(e,t,r){var o=r.httpStack.createRequest(e,t);o.setHeader("Tus-Resumable","1.0.0");var n=r.headers||{};if(Object.entries(n).forEach((function(e){var t=C(e,2),r=t[0],n=t[1];o.setHeader(r,n)})),r.addRequestId){var i="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}));o.setHeader("X-Request-ID",i)}return o}function N(e,t,r){return("function"==typeof r.onBeforeRequest?Promise.resolve(r.onBeforeRequest(e)):Promise.resolve()).then((function(){return e.send(t).then((function(t){return("function"==typeof r.onAfterResponse?Promise.resolve(r.onAfterResponse(e,t)):Promise.resolve()).then((function(){return t}))}))}))}function M(e,t,r){if(null==r.retryDelays||t>=r.retryDelays.length||null==e.originalRequest)return!1;if(r&&"function"==typeof r.onShouldRetry)return r.onShouldRetry(e,t,r);var o,n=e.originalResponse?e.originalResponse.getStatus():0;return(!B(n,400)||409===n||423===n)&&(o=!0,"undefined"!=typeof window&&"navigator"in window&&!1===window.navigator.onLine&&(o=!1),o)}function $(e,t){return new(w())(t,e).toString()}H.defaultOptions=z;var K=H;function X(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var Z=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,o;return t=e,(r=[{key:"listAllUploads",value:function(){return Promise.resolve([])}},{key:"findUploadsByFingerprint",value:function(e){return Promise.resolve([])}},{key:"removeUpload",value:function(e){return Promise.resolve()}},{key:"addUpload",value:function(e,t){return Promise.resolve(null)}}])&&X(t.prototype,r),o&&X(t,o),Object.defineProperty(t,"prototype",{writable:!1}),e}();function G(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var J=!1;try{J="localStorage"in window;var Q="tusSupport",V=localStorage.getItem(Q);localStorage.setItem(Q,V),null===V&&localStorage.removeItem(Q)}catch(e){if(e.code!==e.SECURITY_ERR&&e.code!==e.QUOTA_EXCEEDED_ERR)throw e;J=!1}var W=J,Y=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,o;return t=e,r=[{key:"findAllUploads",value:function(){var e=this._findEntries("tus::");return Promise.resolve(e)}},{key:"findUploadsByFingerprint",value:function(e){var t=this._findEntries("tus::".concat(e,"::"));return Promise.resolve(t)}},{key:"removeUpload",value:function(e){return localStorage.removeItem(e),Promise.resolve()}},{key:"addUpload",value:function(e,t){var r=Math.round(1e12*Math.random()),o="tus::".concat(e,"::").concat(r);return localStorage.setItem(o,JSON.stringify(t)),Promise.resolve(o)}},{key:"_findEntries",value:function(e){for(var t=[],r=0;r<localStorage.length;r++){var o=localStorage.key(r);if(0===o.indexOf(e))try{var n=JSON.parse(localStorage.getItem(o));n.urlStorageKey=o,t.push(n)}catch(e){}}return t}}],r&&G(t.prototype,r),o&&G(t,o),Object.defineProperty(t,"prototype",{writable:!1}),e}();function ee(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function te(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function re(e,t,r){return t&&te(e.prototype,t),r&&te(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}var oe=function(){function e(){ee(this,e)}return re(e,[{key:"createRequest",value:function(e,t){return new ne(e,t)}},{key:"getName",value:function(){return"XHRHttpStack"}}]),e}(),ne=function(){function e(t,r){ee(this,e),this._xhr=new XMLHttpRequest,this._xhr.open(t,r,!0),this._method=t,this._url=r,this._headers={}}return re(e,[{key:"getMethod",value:function(){return this._method}},{key:"getURL",value:function(){return this._url}},{key:"setHeader",value:function(e,t){this._xhr.setRequestHeader(e,t),this._headers[e]=t}},{key:"getHeader",value:function(e){return this._headers[e]}},{key:"setProgressHandler",value:function(e){"upload"in this._xhr&&(this._xhr.upload.onprogress=function(t){t.lengthComputable&&e(t.loaded)})}},{key:"send",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new Promise((function(r,o){e._xhr.onload=function(){r(new ie(e._xhr))},e._xhr.onerror=function(e){o(e)},e._xhr.send(t)}))}},{key:"abort",value:function(){return this._xhr.abort(),Promise.resolve()}},{key:"getUnderlyingObject",value:function(){return this._xhr}}]),e}(),ie=function(){function e(t){ee(this,e),this._xhr=t}return re(e,[{key:"getStatus",value:function(){return this._xhr.status}},{key:"getHeader",value:function(e){return this._xhr.getResponseHeader(e)}},{key:"getBody",value:function(){return this._xhr.responseText}},{key:"getUnderlyingObject",value:function(){return this._xhr}}]),e}(),se=function(){return"undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase()};var ae=function(){return"undefined"!=typeof window&&(void 0!==window.PhoneGap||void 0!==window.Cordova||void 0!==window.cordova)};function le(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var ue=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._file=t,this.size=t.size}var t,r,o;return t=e,(r=[{key:"slice",value:function(e,t){if(ae())return r=this._file.slice(e,t),new Promise((function(e,t){var o=new FileReader;o.onload=function(){var t=new Uint8Array(o.result);e({value:t})},o.onerror=function(e){t(e)},o.readAsArrayBuffer(r)}));var r,o=this._file.slice(e,t);return Promise.resolve({value:o})}},{key:"close",value:function(){}}])&&le(t.prototype,r),o&&le(t,o),Object.defineProperty(t,"prototype",{writable:!1}),e}();function pe(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function ce(e){return void 0===e?0:void 0!==e.size?e.size:e.length}var fe=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._buffer=void 0,this._bufferOffset=0,this._reader=t,this._done=!1}var t,r,o;return t=e,(r=[{key:"slice",value:function(e,t){return e<this._bufferOffset?Promise.reject(new Error("Requested data is before the reader's current offset")):this._readUntilEnoughDataOrDone(e,t)}},{key:"_readUntilEnoughDataOrDone",value:function(e,t){var r=this,o=t<=this._bufferOffset+ce(this._buffer);if(this._done||o){var n=this._getDataFromBuffer(e,t),i=null==n&&this._done;return Promise.resolve({value:n,done:i})}return this._reader.read().then((function(o){var n=o.value;return o.done?r._done=!0:void 0===r._buffer?r._buffer=n:r._buffer=function(e,t){if(e.concat)return e.concat(t);if(e instanceof Blob)return new Blob([e,t],{type:e.type});if(e.set){var r=new e.constructor(e.length+t.length);return r.set(e),r.set(t,e.length),r}throw new Error("Unknown data type")}(r._buffer,n),r._readUntilEnoughDataOrDone(e,t)}))}},{key:"_getDataFromBuffer",value:function(e,t){e>this._bufferOffset&&(this._buffer=this._buffer.slice(e-this._bufferOffset),this._bufferOffset=e);var r=0===ce(this._buffer);return this._done&&r?null:this._buffer.slice(0,t-e)}},{key:"close",value:function(){this._reader.cancel&&this._reader.cancel()}}])&&pe(t.prototype,r),o&&pe(t,o),Object.defineProperty(t,"prototype",{writable:!1}),e}();function he(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var de=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,o;return t=e,(r=[{key:"openFile",value:function(e,t){return se()&&e&&void 0!==e.uri?(r=e.uri,new Promise((function(e,t){var o=new XMLHttpRequest;o.responseType="blob",o.onload=function(){var t=o.response;e(t)},o.onerror=function(e){t(e)},o.open("GET",r),o.send()}))).then((function(e){return new ue(e)})).catch((function(e){throw new Error("tus: cannot fetch `file.uri` as Blob, make sure the uri is correct and accessible. ".concat(e))})):"function"==typeof e.slice&&void 0!==e.size?Promise.resolve(new ue(e)):"function"==typeof e.read?(t=Number(t),Number.isFinite(t)?Promise.resolve(new fe(e,t)):Promise.reject(new Error("cannot create source for stream without a finite value for the `chunkSize` option"))):Promise.reject(new Error("source object may only be an instance of File, Blob, or Reader in this environment"));var r}}])&&he(t.prototype,r),o&&he(t,o),Object.defineProperty(t,"prototype",{writable:!1}),e}();function ye(e){return ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ye(e)}function ve(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function me(e,t){return me=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},me(e,t)}function be(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,o=ge(e);if(t){var n=ge(this).constructor;r=Reflect.construct(o,arguments,n)}else r=o.apply(this,arguments);return function(e,t){if(t&&("object"===ye(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function ge(e){return ge=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ge(e)}function we(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function _e(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?we(Object(r),!0).forEach((function(t){Ue(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):we(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Ue(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Oe=_e(_e({},K.defaultOptions),{},{httpStack:new oe,fileReader:new de,urlStorage:W?new Y:new Z,fingerprint:function(e,t){return se()?Promise.resolve(function(e,t){var r=e.exif?function(e){var t=0;if(0===e.length)return t;for(var r=0;r<e.length;r++){t=(t<<5)-t+e.charCodeAt(r),t&=t}return t}(JSON.stringify(e.exif)):"noexif";return["tus-rn",e.name||"noname",e.size||"nosize",r,t.endpoint].join("/")}(e,t)):Promise.resolve(["tus-br",e.name,e.type,e.size,e.lastModified,t.endpoint].join("-"))}}),Pe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&me(e,t)}(i,e);var t,r,o,n=be(i);function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),t=_e(_e({},Oe),t),n.call(this,e,t)}return t=i,o=[{key:"terminate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t=_e(_e({},Oe),t),K.terminate(e,t)}}],(r=null)&&ve(t.prototype,r),o&&ve(t,o),Object.defineProperty(t,"prototype",{writable:!1}),i}(K),Se=window,Re=Se.XMLHttpRequest,Ee=Se.Blob,ke=(Re&&Ee&&Ee.prototype.slice,r(9537));var je=r(3493)((function(e,t,r){const{progress:o,bytesUploaded:n,bytesTotal:i}=t;o&&(e.uppy.log(`Upload progress: ${o}`),e.uppy.emit("upload-progress",r,{uploader:e,bytesUploaded:n,bytesTotal:i}))}),300,{leading:!0,trailing:!0});function xe(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var Ce=0;function qe(e){return"__private_"+Ce+++"_"+e}var Te=qe("emitter"),Ae=qe("events");class De{constructor(e){Object.defineProperty(this,Te,{writable:!0,value:void 0}),Object.defineProperty(this,Ae,{writable:!0,value:[]}),xe(this,Te)[Te]=e}on(e,t){return xe(this,Ae)[Ae].push([e,t]),xe(this,Te)[Te].on(e,t)}remove(){for(const[e,t]of xe(this,Ae)[Ae].splice(0))xe(this,Te)[Te].off(e,t)}}class Fe extends Error{constructor(e,t){void 0===t&&(t=null),super("This looks like a network error, the endpoint might be blocked by an internet provider or a firewall."),this.cause=e,this.isNetworkError=!0,this.request=t}}var ze=Fe;var He=function(e){return!!e&&(0!==e.readyState&&4!==e.readyState||0===e.status)};function Le(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var Be=0;function Ie(e){return"__private_"+Be+++"_"+e}function Ne(e){if(null!=e){var t;const r=()=>this.abort(e.reason);e.addEventListener("abort",r,{once:!0});const o=()=>{e.removeEventListener("abort",r)};null==(t=this.then)||t.call(this,o,o)}return this}var Me=Ie("activeRequests"),$e=Ie("queuedHandlers"),Ke=Ie("paused"),Xe=Ie("pauseTimer"),Ze=Ie("downLimit"),Ge=Ie("upperLimit"),Je=Ie("rateLimitingTimer"),Qe=Ie("call"),Ve=Ie("queueNext"),We=Ie("next"),Ye=Ie("queue"),et=Ie("dequeue"),tt=Ie("resume"),rt=Ie("increaseLimit");class ot{constructor(e){Object.defineProperty(this,et,{value:lt}),Object.defineProperty(this,Ye,{value:at}),Object.defineProperty(this,We,{value:st}),Object.defineProperty(this,Ve,{value:it}),Object.defineProperty(this,Qe,{value:nt}),Object.defineProperty(this,Me,{writable:!0,value:0}),Object.defineProperty(this,$e,{writable:!0,value:[]}),Object.defineProperty(this,Ke,{writable:!0,value:!1}),Object.defineProperty(this,Xe,{writable:!0,value:void 0}),Object.defineProperty(this,Ze,{writable:!0,value:1}),Object.defineProperty(this,Ge,{writable:!0,value:void 0}),Object.defineProperty(this,Je,{writable:!0,value:void 0}),Object.defineProperty(this,tt,{writable:!0,value:()=>this.resume()}),Object.defineProperty(this,rt,{writable:!0,value:()=>{if(Le(this,Ke)[Ke])Le(this,Je)[Je]=setTimeout(Le(this,rt)[rt],0);else{Le(this,Ze)[Ze]=this.limit,this.limit=Math.ceil((Le(this,Ge)[Ge]+Le(this,Ze)[Ze])/2);for(let e=Le(this,Ze)[Ze];e<=this.limit;e++)Le(this,Ve)[Ve]();Le(this,Ge)[Ge]-Le(this,Ze)[Ze]>3?Le(this,Je)[Je]=setTimeout(Le(this,rt)[rt],2e3):Le(this,Ze)[Ze]=Math.floor(Le(this,Ze)[Ze]/2)}}}),this.limit="number"!=typeof e||0===e?1/0:e}run(e,t){return!Le(this,Ke)[Ke]&&Le(this,Me)[Me]<this.limit?Le(this,Qe)[Qe](e):Le(this,Ye)[Ye](e,t)}wrapSyncFunction(e,t){var r=this;return function(){for(var o=arguments.length,n=new Array(o),i=0;i<o;i++)n[i]=arguments[i];const s=r.run((()=>(e(...n),queueMicrotask((()=>s.done())),()=>{})),t);return{abortOn:Ne,abort(){s.abort()}}}}wrapPromiseFunction(e,t){var r=this;return function(){for(var o=arguments.length,n=new Array(o),i=0;i<o;i++)n[i]=arguments[i];let s;const a=new Promise(((o,i)=>{s=r.run((()=>{let t,r;try{r=Promise.resolve(e(...n))}catch(e){r=Promise.reject(e)}return r.then((e=>{t?i(t):(s.done(),o(e))}),(e=>{t?i(t):(s.done(),i(e))})),e=>{t=function(e){return new Error("Cancelled",{cause:e})}(e)}}),t)}));return a.abort=e=>{s.abort(e)},a.abortOn=Ne,a}}resume(){Le(this,Ke)[Ke]=!1,clearTimeout(Le(this,Xe)[Xe]);for(let e=0;e<this.limit;e++)Le(this,Ve)[Ve]()}pause(e){void 0===e&&(e=null),Le(this,Ke)[Ke]=!0,clearTimeout(Le(this,Xe)[Xe]),null!=e&&(Le(this,Xe)[Xe]=setTimeout(Le(this,tt)[tt],e))}rateLimit(e){clearTimeout(Le(this,Je)[Je]),this.pause(e),this.limit>1&&Number.isFinite(this.limit)&&(Le(this,Ge)[Ge]=this.limit-1,this.limit=Le(this,Ze)[Ze],Le(this,Je)[Je]=setTimeout(Le(this,rt)[rt],e))}get isPaused(){return Le(this,Ke)[Ke]}}function nt(e){Le(this,Me)[Me]+=1;let t,r=!1;try{t=e()}catch(e){throw Le(this,Me)[Me]-=1,e}return{abort:e=>{r||(r=!0,Le(this,Me)[Me]-=1,t(e),Le(this,Ve)[Ve]())},done:()=>{r||(r=!0,Le(this,Me)[Me]-=1,Le(this,Ve)[Ve]())}}}function it(){queueMicrotask((()=>Le(this,We)[We]()))}function st(){if(Le(this,Ke)[Ke]||Le(this,Me)[Me]>=this.limit)return;if(0===Le(this,$e)[$e].length)return;const e=Le(this,$e)[$e].shift(),t=Le(this,Qe)[Qe](e.fn);e.abort=t.abort,e.done=t.done}function at(e,t){void 0===t&&(t={});const r={fn:e,priority:t.priority||0,abort:()=>{Le(this,et)[et](r)},done:()=>{throw new Error("Cannot mark a queued request as done: this indicates a bug")}},o=Le(this,$e)[$e].findIndex((e=>r.priority>e.priority));return-1===o?Le(this,$e)[$e].push(r):Le(this,$e)[$e].splice(o,0,r),r}function lt(e){const t=Le(this,$e)[$e].indexOf(e);-1!==t&&Le(this,$e)[$e].splice(t,1)}Symbol("__queue");function ut(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function pt(e){return(t,r)=>{if("undefined"!=typeof window&&(void 0!==window.PhoneGap||void 0!==window.Cordova||void 0!==window.cordova)||"undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase())return Oe.fingerprint(t,r);const o=["tus",e.id,r.endpoint].join("-");return Promise.resolve(o)}}function ct(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var ft=0;function ht(e){return"__private_"+ft+++"_"+e}const dt={endpoint:"",uploadUrl:null,metadata:{},uploadSize:null,onProgress:null,onChunkComplete:null,onSuccess:null,onError:null,overridePatchMethod:!1,headers:{},addRequestId:!1,chunkSize:1/0,retryDelays:[100,1e3,3e3,5e3],parallelUploads:1,removeFingerprintOnSuccess:!1,uploadLengthDeferred:!1,uploadDataDuringCreation:!1};var yt=ht("retryDelayIterator"),vt=ht("upload"),mt=ht("requestSocketToken"),bt=ht("uploadFiles"),gt=ht("handleUpload");class wt extends o.Z{constructor(e,t){var r,o;super(e,t),Object.defineProperty(this,bt,{value:Ut}),Object.defineProperty(this,vt,{value:_t}),Object.defineProperty(this,yt,{writable:!0,value:void 0}),Object.defineProperty(this,mt,{writable:!0,value:async(e,t)=>{const r=new(e.remote.providerOptions.provider?ke.zt:ke.C$)(this.uppy,e.remote.providerOptions),o={...this.opts};e.tus&&Object.assign(o,e.tus);return(await r.post(e.remote.url,{...e.remote.body,endpoint:o.endpoint,uploadUrl:o.uploadUrl,protocol:"tus",size:e.data.size,headers:o.headers,metadata:e.meta},t)).token}}),Object.defineProperty(this,gt,{writable:!0,value:async e=>{if(0===e.length)return void this.uppy.log("[Tus] No files to upload");0===this.opts.limit&&this.uppy.log("[Tus] When uploading multiple files at once, consider setting the `limit` option (to `10` for example), to limit the number of concurrent uploads, which helps prevent memory and network issues: https://uppy.io/docs/tus/#limit-0","warning"),this.uppy.log("[Tus] Uploading...");const t=this.uppy.getFilesByIds(e);await ct(this,bt)[bt](t)}}),this.type="uploader",this.id=this.opts.id||"Tus",this.title="Tus";const n={useFastRemoteRetry:!0,limit:20,retryDelays:dt.retryDelays,withCredentials:!1};if(this.opts={...n,...t},void 0===(null==t?void 0:t.allowedMetaFields)&&"metaFields"in this.opts)throw new Error("The `metaFields` option has been renamed to `allowedMetaFields`.");if("autoRetry"in t)throw new Error("The `autoRetry` option was deprecated and has been removed.");this.requests=null!=(r=this.opts.rateLimitedQueue)?r:new ot(this.opts.limit),ct(this,yt)[yt]=null==(o=this.opts.retryDelays)?void 0:o.values(),this.uploaders=Object.create(null),this.uploaderEvents=Object.create(null),this.uploaderSockets=Object.create(null),this.handleResetProgress=this.handleResetProgress.bind(this),this.setQueueRequestSocketToken(this.requests.wrapPromiseFunction(ct(this,mt)[mt],{priority:-1}))}handleResetProgress(){const e={...this.uppy.getState().files};Object.keys(e).forEach((t=>{if(e[t].tus&&e[t].tus.uploadUrl){const r={...e[t].tus};delete r.uploadUrl,e[t]={...e[t],tus:r}}})),this.uppy.setState({files:e})}resetUploaderReferences(e,t){if(void 0===t&&(t={}),this.uploaders[e]){const r=this.uploaders[e];r.abort(),t.abort&&r.abort(!0),this.uploaders[e]=null}this.uploaderEvents[e]&&(this.uploaderEvents[e].remove(),this.uploaderEvents[e]=null),this.uploaderSockets[e]&&(this.uploaderSockets[e].close(),this.uploaderSockets[e]=null)}async connectToServerSocket(e){var t=this;return new Promise(((r,o)=>{const n=e.serverToken,i=function(e){const t=/^(?:https?:\/\/|\/\/)?(?:[^@\n]+@)?(?:www\.)?([^\n]+)/i.exec(e)[1];return`${/^http:\/\//i.test(e)?"ws":"wss"}://${t}`}(e.remote.companionUrl),s=new ke.sk({target:`${i}/api/${n}`,autoOpen:!1});let a;this.uploaderSockets[e.id]=s,this.uploaderEvents[e.id]=new De(this.uppy),this.onFileRemove(e.id,(()=>{s.send("cancel",{}),a.abort(),this.resetUploaderReferences(e.id),r(`upload ${e.id} was removed`)})),this.onPause(e.id,(e=>{e?(s.send("pause",{}),a.abort()):(a.abort(),a=this.requests.run((()=>(s.open(),s.send("resume",{}),()=>{}))))})),this.onPauseAll(e.id,(()=>{s.send("pause",{}),a.abort()})),this.onCancelAll(e.id,(function(o){let{reason:n}=void 0===o?{}:o;"user"===n&&(s.send("cancel",{}),a.abort(),t.resetUploaderReferences(e.id)),r(`upload ${e.id} was canceled`)})),this.onResumeAll(e.id,(()=>{a.abort(),e.error&&s.send("pause",{}),a=this.requests.run((()=>(s.open(),s.send("resume",{}),()=>{})))})),this.onRetry(e.id,(()=>{s.isOpen&&(s.send("pause",{}),s.send("resume",{}))})),this.onRetryAll(e.id,(()=>{s.isOpen&&(s.send("pause",{}),s.send("resume",{}))})),s.on("progress",(t=>je(this,t,e))),s.on("error",(t=>{const{message:r}=t.error,n=Object.assign(new Error(r),{cause:t.error});this.opts.useFastRemoteRetry?s.close():(this.resetUploaderReferences(e.id),this.uppy.setFileState(e.id,{serverToken:null})),this.uppy.emit("upload-error",e,n),a.done(),o(n)})),s.on("success",(t=>{const o={uploadURL:t.url};this.uppy.emit("upload-success",e,o),this.resetUploaderReferences(e.id),a.done(),s.close(),r()})),a=this.requests.run((()=>(e.isPaused?s.send("pause",{}):s.open(),()=>{})))}))}onReceiveUploadUrl(e,t){const r=this.uppy.getFile(e.id);r&&(r.tus&&r.tus.uploadUrl===t||(this.uppy.log("[Tus] Storing upload url"),this.uppy.setFileState(r.id,{tus:{...r.tus,uploadUrl:t}})))}onFileRemove(e,t){this.uploaderEvents[e].on("file-removed",(r=>{e===r.id&&t(r.id)}))}onPause(e,t){this.uploaderEvents[e].on("upload-pause",((r,o)=>{e===r&&t(o)}))}onRetry(e,t){this.uploaderEvents[e].on("upload-retry",(r=>{e===r&&t()}))}onRetryAll(e,t){this.uploaderEvents[e].on("retry-all",(()=>{this.uppy.getFile(e)&&t()}))}onPauseAll(e,t){this.uploaderEvents[e].on("pause-all",(()=>{this.uppy.getFile(e)&&t()}))}onCancelAll(e,t){var r=this;this.uploaderEvents[e].on("cancel-all",(function(){r.uppy.getFile(e)&&t(...arguments)}))}onResumeAll(e,t){this.uploaderEvents[e].on("resume-all",(()=>{this.uppy.getFile(e)&&t()}))}install(){this.uppy.setState({capabilities:{...this.uppy.getState().capabilities,resumableUploads:!0}}),this.uppy.addUploader(ct(this,gt)[gt]),this.uppy.on("reset-progress",this.handleResetProgress)}uninstall(){this.uppy.setState({capabilities:{...this.uppy.getState().capabilities,resumableUploads:!1}}),this.uppy.removeUploader(ct(this,gt)[gt])}}function _t(e){var t=this;return this.resetUploaderReferences(e.id),new Promise(((r,o)=>{let n,i,s;const a={...this.opts,...e.tus||{}};"function"==typeof a.headers&&(a.headers=a.headers(e));const l={...dt,...a};l.fingerprint=pt(e),l.onBeforeRequest=t=>{let r;if(t.getUnderlyingObject().withCredentials=!!a.withCredentials,"function"==typeof a.onBeforeRequest&&(r=a.onBeforeRequest(t,e)),ut(n,"shouldBeRequeued")){if(!n.shouldBeRequeued)return Promise.reject();let t;const o=new Promise((e=>{t=e}));return n=this.requests.run((()=>(e.isPaused&&n.abort(),t(),()=>{}))),Promise.all([o,r])}return r},l.onError=t=>{var r;this.uppy.log(t);const i=t.originalRequest?t.originalRequest.getUnderlyingObject():null;He(i)&&(t=new ze(t,i)),this.resetUploaderReferences(e.id),null==(r=n)||r.abort(),this.uppy.emit("upload-error",e,t),o(t)},l.onProgress=(t,r)=>{this.onReceiveUploadUrl(e,s.url),this.uppy.emit("upload-progress",e,{uploader:this,bytesUploaded:t,bytesTotal:r})},l.onSuccess=()=>{const t={uploadURL:s.url};this.resetUploaderReferences(e.id),n.done(),this.uppy.emit("upload-success",e,t),s.url&&this.uppy.log(`Download ${s.file.name} from ${s.url}`),r(s)};const u=e=>{var t;const r=null==e||null==(t=e.originalResponse)?void 0:t.getStatus();if(429===r){if(!this.requests.isPaused){var o;const e=null==(o=ct(this,yt)[yt])?void 0:o.next();if(null==e||e.done)return!1;this.requests.rateLimit(e.value)}}else{if(r>400&&r<500&&409!==r&&423!==r)return!1;"undefined"!=typeof navigator&&!1===navigator.onLine&&(this.requests.isPaused||(this.requests.pause(),window.addEventListener("online",(()=>{this.requests.resume()}),{once:!0})))}return n.abort(),n={shouldBeRequeued:!0,abort(){this.shouldBeRequeued=!1},done(){throw new Error("Cannot mark a queued request as done: this indicates a bug")},fn(){throw new Error("Cannot run a queued request: this indicates a bug")}},!0};null!=a.onShouldRetry?l.onShouldRetry=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return a.onShouldRetry(...t,u)}:l.onShouldRetry=u;const p=(e,t,r)=>{ut(e,t)&&!ut(e,r)&&(e[r]=e[t])},c={};(Array.isArray(a.allowedMetaFields)?a.allowedMetaFields:Object.keys(e.meta)).forEach((t=>{c[t]=e.meta[t]})),p(c,"type","filetype"),p(c,"name","filename"),l.metadata=c,s=new Pe(e.data,l),this.uploaders[e.id]=s,this.uploaderEvents[e.id]=new De(this.uppy),i=()=>(e.isPaused||s.start(),()=>{}),s.findPreviousUploads().then((t=>{const r=t[0];r&&(this.uppy.log(`[Tus] Resuming upload of ${e.id} started at ${r.creationTime}`),s.resumeFromPreviousUpload(r))})),n=this.requests.run(i),this.onFileRemove(e.id,(t=>{n.abort(),this.resetUploaderReferences(e.id,{abort:!!s.url}),r(`upload ${t} was removed`)})),this.onPause(e.id,(e=>{n.abort(),e?s.abort():n=this.requests.run(i)})),this.onPauseAll(e.id,(()=>{n.abort(),s.abort()})),this.onCancelAll(e.id,(function(o){let{reason:i}=void 0===o?{}:o;"user"===i&&(n.abort(),t.resetUploaderReferences(e.id,{abort:!!s.url})),r(`upload ${e.id} was canceled`)})),this.onResumeAll(e.id,(()=>{n.abort(),e.error&&s.abort(),n=this.requests.run(i)}))})).catch((t=>{throw this.uppy.emit("upload-error",e,t),t}))}async function Ut(e){const t=function(e){return e.filter((e=>!(e=>"error"in e&&e.error)(e)))}(e),r=function(e){return e.filter((e=>!e.progress.uploadStarted||!e.isRestored))}(t);this.uppy.emit("upload-start",r),await Promise.allSettled(t.map(((t,r)=>{const o=r+1,n=e.length;if(t.isRemote){const e=new AbortController,r=r=>{r.id===t.id&&e.abort()};this.uppy.on("file-removed",r),this.resetUploaderReferences(t.id);const o=this.uploadRemoteFile(t,{signal:e.signal});return this.requests.wrapSyncFunction((()=>{this.uppy.off("file-removed",r)}),{priority:-1})(),o}return ct(this,vt)[vt](t,o,n)})))}wt.VERSION="3.1.2"}}]);